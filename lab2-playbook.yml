---
- name: Configure switches
  hosts: switches
  gather_facts: false
  tasks:
    - name: Set hostnames
      ios_system:
        hostname: "{{ hostname_update }}"
        state: present

    - name: Set MOTD
      ios_banner:
        banner: motd
        text: Configured by Ansible automation. Use the Ansible configuration-as-code files to update this device's settings. Do not edit the configuration directly unless directed to do so by the Director of IT!
        state: present

    - name: Set up 3 VLANs
      ios_vlans:
        config:
          - name: "{{ item.name }}"
            vlan_id: "{{ item.vlan }}"
            shutdown: disabled
            state: active
        state: replaced
      loop:
        - { name: V10, vlan: 10 }
        - { name: V20, vlan: 20 }
        - { name: V30, vlan: 30 }

    - name: connect ports to VLANs
      ios_l2_interfaces:
        config:
          - name: "{{ item.name }}"
            access:
              vlan: "{{ item.vlan }}"
        state: replaced
      loop:
        - { name: "GigabitEthernet1/0/1-8", vlan: 10 }
        - { name: "GigabitEthernet1/0/9-16", vlan: 20 }
        - { name: "GigabitEthernet1/0/17-22", vlan: 30 }

    - name: Set up trunk port
      ios_l2_interfaces:
        config:
          - name: GigabitEthernet0/24
            trunk:
              allowed_vlans: 1,10,20,30
        state: replaced

    - name: Save configuration
      ios_config:
        save_when: modified
